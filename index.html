<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TypeFarm</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --bg-dark: #0a0a0f;
            --bg-panel: #12121a;
            --bg-input: #1a1a25;
            --text-primary: #e8e8e8;
            --text-dim: #888;
            --accent-cyan: #00d9ff;
            --accent-green: #00ff88;
            --accent-yellow: #ffd700;
            --accent-red: #ff4757;
            --border: #2a2a3a;
        }

        body {
            font-family: 'Courier New', monospace;
            background: var(--bg-dark);
            color: var(--text-primary);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Header */
        .header {
            background: var(--bg-panel);
            border-bottom: 1px solid var(--border);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 1.8rem;
            background: linear-gradient(90deg, var(--accent-cyan), var(--accent-green));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stats {
            display: flex;
            gap: 2rem;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 1.4rem;
            font-weight: bold;
            color: var(--accent-yellow);
        }

        .stat-label {
            font-size: 0.7rem;
            color: var(--text-dim);
            text-transform: uppercase;
        }

        /* Main Content */
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* Terminal Log */
        .terminal-log {
            width: 33%;
            background: var(--bg-panel);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
        }

        .terminal-log-header {
            padding: 0.5rem 1rem;
            background: var(--bg-input);
            border-bottom: 1px solid var(--border);
            font-size: 0.8rem;
            color: var(--accent-cyan);
        }

        .terminal-log-content {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            font-size: 0.85rem;
            line-height: 1.6;
        }

        .log-entry {
            margin-bottom: 0.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border);
        }

        .log-system { color: var(--accent-cyan); }
        .log-success { color: var(--accent-green); }
        .log-warning { color: var(--accent-yellow); }
        .log-error { color: var(--accent-red); }
        .log-npc { color: #ff9ff3; }

        /* Game Frame */
        .game-frame {
            width: 67%;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .game-frame-header {
            padding: 0.5rem 1rem;
            background: var(--bg-input);
            border-bottom: 1px solid var(--border);
            font-size: 0.8rem;
            color: var(--accent-green);
            display: flex;
            gap: 1rem;
        }

        .tab {
            cursor: pointer;
            padding: 0.3rem 0.8rem;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .tab:hover { background: var(--border); }
        .tab.active { background: var(--accent-green); color: var(--bg-dark); }

        .game-content {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
        }

        /* Typing Area */
        .typing-section {
            margin-bottom: 2rem;
        }

        .typing-prompt {
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            font-size: 1.2rem;
            line-height: 1.8;
            margin-bottom: 1rem;
            min-height: 100px;
        }

        .typing-prompt .correct { color: var(--accent-green); }
        .typing-prompt .incorrect { color: var(--accent-red); background: rgba(255,71,87,0.2); }
        .typing-prompt .cursor { border-left: 2px solid var(--accent-cyan); animation: blink 1s infinite; }
        .typing-prompt .pending { color: var(--text-dim); }

        @keyframes blink { 50% { border-color: transparent; } }

        .typing-input {
            width: 100%;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            font-family: inherit;
            font-size: 1rem;
            color: var(--text-primary);
            outline: none;
        }

        .typing-input:focus { border-color: var(--accent-cyan); }

        .typing-stats {
            display: flex;
            gap: 2rem;
            margin-top: 1rem;
            font-size: 0.9rem;
            color: var(--text-dim);
        }

        /* Shop */
        .shop-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }

        .shop-item {
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .shop-item:hover {
            border-color: var(--accent-cyan);
            transform: translateY(-2px);
        }

        .shop-item-name { font-weight: bold; color: var(--accent-cyan); }
        .shop-item-price { color: var(--accent-yellow); margin: 0.5rem 0; }
        .shop-item-desc { font-size: 0.8rem; color: var(--text-dim); }

        /* Farm */
        .farm-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            max-width: 500px;
        }

        .farm-plot {
            aspect-ratio: 1;
            background: #3d2817;
            border: 2px solid #5a3d21;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 2rem;
        }

        .farm-plot:hover { border-color: var(--accent-green); }
        .farm-plot.empty { background: #2a1f0f; }
        .farm-plot.growing { background: #3d4a17; }
        .farm-plot.ready { background: #4a6a17; border-color: var(--accent-yellow); }

        .plot-status {
            font-size: 0.6rem;
            color: var(--text-dim);
            margin-top: 0.3rem;
        }

        /* Inventory */
        .inventory-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .inventory-item {
            background: var(--bg-input);
            border: 1px solid var(--border);
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-size: 0.85rem;
        }

        /* Terminal Input */
        .terminal-input-bar {
            background: var(--bg-panel);
            border-top: 1px solid var(--border);
            padding: 1rem 2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .terminal-prompt { color: var(--accent-green); }

        .terminal-input {
            flex: 1;
            background: transparent;
            border: none;
            font-family: inherit;
            font-size: 1rem;
            color: var(--text-primary);
            outline: none;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-dark); }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--text-dim); }

        /* NPC */
        .npc-dialogue {
            background: var(--bg-input);
            border-left: 3px solid #ff9ff3;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 0 8px 8px 0;
        }

        .npc-name { color: #ff9ff3; font-weight: bold; margin-bottom: 0.5rem; }
    </style>
</head>
<body>
    <header class="header">
        <h1>üå± TypeFarm</h1>
        <div class="stats">
            <div class="stat">
                <div class="stat-value" id="coins">0</div>
                <div class="stat-label">Coins</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="wpm">0</div>
                <div class="stat-label">WPM</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="accuracy">100%</div>
                <div class="stat-label">Accuracy</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="level">1</div>
                <div class="stat-label">Level</div>
            </div>
        </div>
    </header>

    <main class="main-content">
        <aside class="terminal-log">
            <div class="terminal-log-header">üìü Terminal Log</div>
            <div class="terminal-log-content" id="log"></div>
        </aside>

        <section class="game-frame">
            <div class="game-frame-header">
                <span class="tab active" data-view="typing">‚å®Ô∏è Typing</span>
                <span class="tab" data-view="shop">üè™ Shop</span>
                <span class="tab" data-view="farm">üåæ Farm</span>
                <span class="tab" data-view="inventory">üéí Inventory</span>
            </div>
            <div class="game-content" id="game-content"></div>
        </section>
    </main>

    <footer class="terminal-input-bar">
        <span class="terminal-prompt">$</span>
        <input type="text" class="terminal-input" id="command-input" placeholder="Type a command... (try 'help')" autocomplete="off">
    </footer>

    <script>
        // ==================== GAME STATE ====================
        const state = {
            coins: 0,
            level: 1,
            xp: 0,
            totalKeystrokes: 0,
            correctKeystrokes: 0,
            startTime: null,
            inventory: {
                'Carrot Seeds': 3,
                'Tomato Seeds': 2
            },
            farm: [
                null, null, null, null,
                null, null, null, null
            ],
            shopItems: [
                { id: 'carrot-seeds', name: 'Carrot Seeds', price: 10, desc: 'Grows in 30 seconds' },
                { id: 'tomato-seeds', name: 'Tomato Seeds', price: 25, desc: 'Grows in 60 seconds' },
                { id: 'corn-seeds', name: 'Corn Seeds', price: 50, desc: 'Grows in 90 seconds' },
                { id: 'golden-seeds', name: 'Golden Seeds', price: 200, desc: 'Rare! Grows in 120 seconds' },
                { id: 'fertilizer', name: 'Fertilizer', price: 30, desc: 'Speeds up growth by 50%' },
                { id: 'water-can', name: 'Golden Watering Can', price: 100, desc: 'Auto-waters your crops' }
            ],
            currentView: 'typing',
            typingText: '',
            typingIndex: 0
        };

        const prompts = [
            "The quick brown fox jumps over the lazy dog.",
            "Pack my box with five dozen liquor jugs.",
            "How vexingly quick daft zebras jump!",
            "The farmer planted seeds in the fertile soil.",
            "Vegetables grow best with sunshine and water.",
            "Typing fast earns more coins for the farm.",
            "Buy seeds from the shop to grow your crops.",
            "Harvest your plants when they are ready.",
            "The seasons change and so do the crops.",
            "A good farmer types with speed and precision."
        ];

        // ==================== UTILITIES ====================
        function saveGame() {
            localStorage.setItem('typefarm-save', JSON.stringify(state));
        }

        function loadGame() {
            const saved = localStorage.getItem('typefarm-save');
            if (saved) {
                const data = JSON.parse(saved);
                Object.assign(state, data);
            }
        }

        function log(message, type = 'system') {
            const logEl = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.innerHTML = `<span style="color:#666">[${new Date().toLocaleTimeString()}]</span> ${message}`;
            logEl.appendChild(entry);
            logEl.scrollTop = logEl.scrollHeight;
        }

        function updateStats() {
            document.getElementById('coins').textContent = state.coins;
            document.getElementById('level').textContent = state.level;

            if (state.totalKeystrokes > 0) {
                const acc = Math.round((state.correctKeystrokes / state.totalKeystrokes) * 100);
                document.getElementById('accuracy').textContent = acc + '%';
            }

            if (state.startTime && state.correctKeystrokes > 0) {
                const minutes = (Date.now() - state.startTime) / 60000;
                const wpm = Math.round((state.correctKeystrokes / 5) / minutes);
                document.getElementById('wpm').textContent = Math.min(wpm, 999);
            }
        }

        function addCoins(amount) {
            state.coins += amount;
            state.xp += amount;
            if (state.xp >= state.level * 100) {
                state.level++;
                log(`üéâ Level up! You are now level ${state.level}!`, 'success');
            }
            updateStats();
            saveGame();
        }

        // ==================== VIEWS ====================
        function renderTyping() {
            if (!state.typingText) {
                state.typingText = prompts[Math.floor(Math.random() * prompts.length)];
                state.typingIndex = 0;
            }

            let html = '<div class="typing-section">';
            html += '<h2 style="margin-bottom:1rem;color:var(--accent-cyan)">‚å®Ô∏è Type to Earn Coins</h2>';
            html += '<div class="typing-prompt">';

            for (let i = 0; i < state.typingText.length; i++) {
                if (i < state.typingIndex) {
                    html += `<span class="correct">${state.typingText[i]}</span>`;
                } else if (i === state.typingIndex) {
                    html += `<span class="cursor">${state.typingText[i]}</span>`;
                } else {
                    html += `<span class="pending">${state.typingText[i]}</span>`;
                }
            }

            html += '</div>';
            html += `<input type="text" class="typing-input" id="typing-input" placeholder="Start typing here..." autocomplete="off">`;
            html += '<div class="typing-stats">';
            html += `<span>Progress: ${state.typingIndex}/${state.typingText.length}</span>`;
            html += `<span>Coins per char: ${state.level}</span>`;
            html += '</div>';
            html += '</div>';

            return html;
        }

        function renderShop() {
            let html = '<div class="npc-dialogue"><div class="npc-name">üßë‚Äçüåæ Farmer Joe</div>';
            html += '"Welcome to my shop! Type to earn coins, then buy seeds to grow your farm!"</div>';
            html += '<h2 style="margin-bottom:1rem;color:var(--accent-cyan)">üè™ Shop</h2>';
            html += `<p style="margin-bottom:1rem;color:var(--text-dim)">Your coins: <span style="color:var(--accent-yellow)">${state.coins}</span></p>`;
            html += '<div class="shop-grid">';

            for (const item of state.shopItems) {
                html += `<div class="shop-item" onclick="buyItem('${item.id}')">`;
                html += `<div class="shop-item-name">${item.name}</div>`;
                html += `<div class="shop-item-price">üí∞ ${item.price} coins</div>`;
                html += `<div class="shop-item-desc">${item.desc}</div>`;
                html += '</div>';
            }

            html += '</div>';
            return html;
        }

        function renderFarm() {
            let html = '<h2 style="margin-bottom:1rem;color:var(--accent-cyan)">üåæ Your Farm</h2>';
            html += '<p style="margin-bottom:1rem;color:var(--text-dim)">Click a plot to plant or harvest.</p>';
            html += '<div class="farm-grid">';

            for (let i = 0; i < state.farm.length; i++) {
                const plot = state.farm[i];
                let plotClass = 'empty';
                let plotContent = 'üü´';
                let plotStatus = 'Empty';

                if (plot) {
                    const elapsed = Date.now() - plot.plantedAt;
                    const growTime = plot.growTime * 1000;

                    if (elapsed >= growTime) {
                        plotClass = 'ready';
                        plotContent = plot.harvestEmoji;
                        plotStatus = 'Ready!';
                    } else {
                        plotClass = 'growing';
                        plotContent = 'üå±';
                        const remaining = Math.ceil((growTime - elapsed) / 1000);
                        plotStatus = `${remaining}s`;
                    }
                }

                html += `<div class="farm-plot ${plotClass}" onclick="interactPlot(${i})">`;
                html += plotContent;
                html += `<div class="plot-status">${plotStatus}</div>`;
                html += '</div>';
            }

            html += '</div>';
            return html;
        }

        function renderInventory() {
            let html = '<h2 style="margin-bottom:1rem;color:var(--accent-cyan)">üéí Inventory</h2>';

            const items = Object.entries(state.inventory).filter(([k, v]) => v > 0);

            if (items.length === 0) {
                html += '<p style="color:var(--text-dim)">Your inventory is empty. Buy some seeds from the shop!</p>';
            } else {
                html += '<div class="inventory-grid">';
                for (const [name, count] of items) {
                    html += `<div class="inventory-item">${name}: ${count}</div>`;
                }
                html += '</div>';
            }

            return html;
        }

        function switchView(view) {
            state.currentView = view;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`[data-view="${view}"]`).classList.add('active');
            render();
        }

        function render() {
            const content = document.getElementById('game-content');
            switch (state.currentView) {
                case 'typing': content.innerHTML = renderTyping(); setupTyping(); break;
                case 'shop': content.innerHTML = renderShop(); break;
                case 'farm': content.innerHTML = renderFarm(); break;
                case 'inventory': content.innerHTML = renderInventory(); break;
            }
        }

        // ==================== TYPING ====================
        function setupTyping() {
            const input = document.getElementById('typing-input');
            if (!input) return;

            input.focus();
            input.addEventListener('input', handleTyping);
        }

        function handleTyping(e) {
            if (!state.startTime) state.startTime = Date.now();

            const typed = e.target.value;
            const lastChar = typed[typed.length - 1];
            const expected = state.typingText[state.typingIndex];

            state.totalKeystrokes++;

            if (lastChar === expected) {
                state.correctKeystrokes++;
                state.typingIndex++;
                addCoins(state.level);

                if (state.typingIndex >= state.typingText.length) {
                    log(`‚úÖ Completed: "${state.typingText.substring(0, 30)}..."`, 'success');
                    addCoins(state.level * 10); // Bonus for completion
                    state.typingText = prompts[Math.floor(Math.random() * prompts.length)];
                    state.typingIndex = 0;
                }
            } else {
                log(`‚ùå Typo! Expected '${expected}'`, 'error');
            }

            e.target.value = '';
            updateStats();
            render();
        }

        // ==================== SHOP ====================
        function buyItem(itemId) {
            const item = state.shopItems.find(i => i.id === itemId);
            if (!item) return;

            if (state.coins < item.price) {
                log(`‚ùå Not enough coins! Need ${item.price}, have ${state.coins}`, 'error');
                return;
            }

            state.coins -= item.price;
            state.inventory[item.name] = (state.inventory[item.name] || 0) + 1;
            log(`üõí Bought ${item.name} for ${item.price} coins`, 'success');
            updateStats();
            saveGame();
            render();
        }

        // ==================== FARM ====================
        const crops = {
            'Carrot Seeds': { growTime: 30, harvestEmoji: 'ü•ï', sellPrice: 20 },
            'Tomato Seeds': { growTime: 60, harvestEmoji: 'üçÖ', sellPrice: 50 },
            'Corn Seeds': { growTime: 90, harvestEmoji: 'üåΩ', sellPrice: 100 },
            'Golden Seeds': { growTime: 120, harvestEmoji: '‚ú®', sellPrice: 500 }
        };

        function interactPlot(index) {
            const plot = state.farm[index];

            if (!plot) {
                // Plant something
                const seeds = Object.keys(state.inventory).filter(k => k.includes('Seeds') && state.inventory[k] > 0);
                if (seeds.length === 0) {
                    log('‚ùå No seeds! Buy some from the shop.', 'error');
                    return;
                }

                const seed = seeds[0];
                const cropInfo = crops[seed];
                state.inventory[seed]--;
                state.farm[index] = {
                    type: seed,
                    plantedAt: Date.now(),
                    growTime: cropInfo.growTime,
                    harvestEmoji: cropInfo.harvestEmoji,
                    sellPrice: cropInfo.sellPrice
                };
                log(`üå± Planted ${seed} in plot ${index + 1}`, 'success');
            } else {
                const elapsed = Date.now() - plot.plantedAt;
                if (elapsed >= plot.growTime * 1000) {
                    // Harvest
                    addCoins(plot.sellPrice);
                    log(`üåæ Harvested ${plot.harvestEmoji} for ${plot.sellPrice} coins!`, 'success');
                    state.farm[index] = null;
                } else {
                    const remaining = Math.ceil((plot.growTime * 1000 - elapsed) / 1000);
                    log(`‚è≥ Not ready yet! ${remaining} seconds remaining.`, 'warning');
                }
            }

            saveGame();
            render();
        }

        // ==================== COMMANDS ====================
        const commands = {
            help: () => {
                log('üìñ Commands: help, shop, farm, inventory, stats, clear, plant, harvest', 'system');
            },
            shop: () => switchView('shop'),
            farm: () => switchView('farm'),
            inventory: () => switchView('inventory'),
            type: () => switchView('typing'),
            stats: () => {
                log(`üìä Level: ${state.level} | Coins: ${state.coins} | XP: ${state.xp}`, 'system');
            },
            clear: () => {
                document.getElementById('log').innerHTML = '';
                log('üßπ Log cleared', 'system');
            },
            save: () => {
                saveGame();
                log('üíæ Game saved!', 'success');
            }
        };

        function handleCommand(cmd) {
            const parts = cmd.toLowerCase().trim().split(' ');
            const command = parts[0];

            if (commands[command]) {
                commands[command](parts.slice(1));
            } else {
                log(`‚ùì Unknown command: ${command}. Type 'help' for commands.`, 'warning');
            }
        }

        // ==================== INIT ====================
        function init() {
            loadGame();
            updateStats();
            render();

            // Tab switching
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => switchView(tab.dataset.view));
            });

            // Command input
            document.getElementById('command-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && e.target.value.trim()) {
                    handleCommand(e.target.value);
                    e.target.value = '';
                }
            });

            // Auto-update farm
            setInterval(() => {
                if (state.currentView === 'farm') render();
            }, 1000);

            // Welcome message
            log('üå± Welcome to TypeFarm!', 'success');
            log('Type to earn coins, buy seeds, grow crops!', 'system');
            log("Type 'help' for commands.", 'system');
        }

        init();
    </script>
</body>
</html>
