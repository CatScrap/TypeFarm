<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TypeFarm</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --bg-dark: #0a0a0f;
            --bg-panel: #12121a;
            --bg-input: #1a1a25;
            --text-primary: #e8e8e8;
            --text-dim: #555;
            --text-predict: #444;
            --accent-cyan: #00d9ff;
            --accent-green: #00ff88;
            --accent-yellow: #ffd700;
            --accent-red: #ff4757;
            --accent-pink: #ff9ff3;
            --border: #2a2a3a;
        }

        body {
            font-family: 'Courier New', monospace;
            background: var(--bg-dark);
            color: var(--text-primary);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            background: var(--bg-panel);
            border-bottom: 1px solid var(--border);
            padding: 0.6rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 1.3rem;
            background: linear-gradient(90deg, var(--accent-cyan), var(--accent-green));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stats {
            display: flex;
            gap: 1.2rem;
            font-size: 0.85rem;
        }

        .stat span { color: var(--accent-yellow); }

        /* Three Lane Layout */
        .lanes {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .lane {
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border);
            overflow: hidden;
        }

        .lane:last-child { border-right: none; }

        .lane-actions { width: 25%; }
        .lane-commands { width: 25%; }
        .lane-game { width: 50%; }

        .lane-header {
            padding: 0.4rem 0.8rem;
            background: var(--bg-input);
            border-bottom: 1px solid var(--border);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .lane-actions .lane-header { color: var(--accent-cyan); }
        .lane-commands .lane-header { color: var(--accent-pink); }
        .lane-game .lane-header { color: var(--accent-green); }

        .lane-content {
            flex: 1;
            overflow-y: auto;
            padding: 0.6rem;
            font-size: 0.8rem;
            line-height: 1.5;
        }

        .lane-game .lane-content {
            white-space: pre-wrap;
            font-size: 0.85rem;
        }

        /* Log Entries */
        .log-entry {
            margin-bottom: 0.3rem;
            padding: 0.2rem 0;
        }

        .log-system { color: var(--accent-cyan); }
        .log-success { color: var(--accent-green); }
        .log-warning { color: var(--accent-yellow); }
        .log-error { color: var(--accent-red); }

        /* Command Log */
        .cmd-entry {
            margin-bottom: 0.3rem;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
        }

        .cmd-valid {
            color: var(--accent-green);
            background: rgba(0, 255, 136, 0.05);
        }

        .cmd-invalid {
            color: var(--accent-red);
            background: rgba(255, 71, 87, 0.1);
        }

        .cmd-prefix {
            color: var(--text-dim);
            margin-right: 0.3rem;
        }

        /* Terminal Input */
        .terminal-bar {
            background: var(--bg-panel);
            border-top: 1px solid var(--border);
            padding: 0.6rem 1rem;
        }

        .input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 0.5rem 0.8rem;
        }

        .input-wrapper:focus-within {
            border-color: var(--accent-cyan);
        }

        .terminal-prompt {
            color: var(--accent-green);
            margin-right: 0.5rem;
        }

        .input-container {
            position: relative;
            flex: 1;
            font-family: 'Courier New', monospace;
        }

        .terminal-input {
            width: 100%;
            background: transparent;
            border: none;
            font-family: inherit;
            font-size: 1rem;
            color: var(--text-primary);
            outline: none;
            caret-color: var(--accent-cyan);
        }

        .prediction-text {
            position: absolute;
            top: 0;
            left: 0;
            font-size: 1rem;
            color: var(--text-predict);
            pointer-events: none;
            user-select: none;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: var(--bg-dark); }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

        /* Game Display */
        .section-title { color: var(--accent-cyan); margin-bottom: 0.5rem; }
        .highlight { color: var(--accent-yellow); }
        .dim { color: var(--text-dim); }
        .green { color: var(--accent-green); }
        .red { color: var(--accent-red); }
        .pink { color: var(--accent-pink); }
    </style>
</head>
<body>
    <header class="header">
        <h1>üå± TypeFarm</h1>
        <div class="stats">
            <div>üí∞ <span id="coins">50</span></div>
            <div>üåæ Season: <span id="season">Spring</span></div>
            <div>üìÖ Day <span id="day">1</span></div>
        </div>
    </header>

    <main class="lanes">
        <aside class="lane lane-actions">
            <div class="lane-header">üì° Actions</div>
            <div class="lane-content" id="actions-log"></div>
        </aside>

        <aside class="lane lane-commands">
            <div class="lane-header">üìù Command Log</div>
            <div class="lane-content" id="command-log"></div>
        </aside>

        <section class="lane lane-game">
            <div class="lane-header">üéÆ Game</div>
            <div class="lane-content" id="display"></div>
        </section>
    </main>

    <footer class="terminal-bar">
        <div class="input-wrapper">
            <span class="terminal-prompt">$</span>
            <div class="input-container">
                <span class="prediction-text" id="prediction"></span>
                <input type="text" class="terminal-input" id="input" autocomplete="off" autofocus>
            </div>
        </div>
    </footer>

    <script>
        // ==================== GAME STATE ====================
        const state = {
            coins: 50,
            day: 1,
            season: 'Spring',
            inventory: {},
            farm: Array(9).fill(null),
            shopItems: {
                'carrot seeds': { price: 10, desc: 'Grows 30s, sells 25' },
                'tomato seeds': { price: 20, desc: 'Grows 45s, sells 50' },
                'corn seeds': { price: 35, desc: 'Grows 60s, sells 80' },
                'pumpkin seeds': { price: 50, desc: 'Grows 90s, sells 120' },
                'golden seeds': { price: 150, desc: 'Grows 120s, sells 400' },
                'fertilizer': { price: 25, desc: 'Halves grow time' },
                'watering can': { price: 100, desc: 'Auto-water crops' }
            },
            crops: {
                'carrot seeds': { growTime: 30, emoji: 'ü•ï', sellPrice: 25, stages: ['üå±', 'üåø', 'ü•ï'] },
                'tomato seeds': { growTime: 45, emoji: 'üçÖ', sellPrice: 50, stages: ['üå±', 'üåø', 'üçÖ'] },
                'corn seeds': { growTime: 60, emoji: 'üåΩ', sellPrice: 80, stages: ['üå±', 'üåæ', 'üåΩ'] },
                'pumpkin seeds': { growTime: 90, emoji: 'üéÉ', sellPrice: 120, stages: ['üå±', 'üåø', 'üéÉ'] },
                'golden seeds': { growTime: 120, emoji: '‚ú®', sellPrice: 400, stages: ['üå±', 'üí´', '‚ú®'] }
            }
        };

        const plotNames = ['A1', 'A2', 'A3', 'B1', 'B2', 'B3', 'C1', 'C2', 'C3'];

        // All possible commands for prediction
        const allCommands = [
            'help',
            'shop', 'shop buy carrot seeds', 'shop buy tomato seeds',
            'shop buy corn seeds', 'shop buy pumpkin seeds', 'shop buy golden seeds',
            'shop buy fertilizer', 'shop buy watering can',
            'shop sell carrot', 'shop sell tomato', 'shop sell corn', 'shop sell pumpkin', 'shop sell golden',
            'farm',
            'farm plant carrot A1', 'farm plant carrot A2', 'farm plant carrot A3',
            'farm plant carrot B1', 'farm plant carrot B2', 'farm plant carrot B3',
            'farm plant carrot C1', 'farm plant carrot C2', 'farm plant carrot C3',
            'farm plant tomato A1', 'farm plant tomato A2', 'farm plant tomato A3',
            'farm plant corn A1', 'farm plant pumpkin A1', 'farm plant golden A1',
            'farm water A1', 'farm water A2', 'farm water A3',
            'farm water B1', 'farm water B2', 'farm water B3',
            'farm water C1', 'farm water C2', 'farm water C3',
            'farm harvest A1', 'farm harvest A2', 'farm harvest A3',
            'farm harvest B1', 'farm harvest B2', 'farm harvest B3',
            'farm harvest C1', 'farm harvest C2', 'farm harvest C3',
            'farm fertilize A1', 'farm fertilize B1', 'farm fertilize C1',
            'inventory', 'inv',
            'stats',
            'clear',
            'save'
        ];

        // ==================== UTILITIES ====================
        function save() { localStorage.setItem('typefarm', JSON.stringify(state)); }

        function load() {
            const saved = localStorage.getItem('typefarm');
            if (saved) Object.assign(state, JSON.parse(saved));
        }

        function action(msg, type = 'system') {
            const el = document.getElementById('actions-log');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = msg;
            el.appendChild(entry);
            el.scrollTop = el.scrollHeight;
        }

        function logCommand(cmd, valid) {
            const el = document.getElementById('command-log');
            const entry = document.createElement('div');
            entry.className = `cmd-entry ${valid ? 'cmd-valid' : 'cmd-invalid'}`;
            entry.innerHTML = `<span class="cmd-prefix">$</span>${cmd}`;
            el.appendChild(entry);
            el.scrollTop = el.scrollHeight;
        }

        function display(content) {
            document.getElementById('display').innerHTML = content;
        }

        function updateStats() {
            document.getElementById('coins').textContent = state.coins;
            document.getElementById('day').textContent = state.day;
            document.getElementById('season').textContent = state.season;
        }

        function addCoins(n) {
            state.coins += n;
            updateStats();
            save();
        }

        function getPlotIndex(name) {
            return plotNames.indexOf(name.toUpperCase());
        }

        // ==================== PREDICTION ====================
        function updatePrediction(inputValue) {
            const predictionEl = document.getElementById('prediction');
            const val = inputValue.toLowerCase();

            if (!val) {
                predictionEl.textContent = '';
                return;
            }

            // Find best matching command
            let bestMatch = '';
            for (const cmd of allCommands) {
                if (cmd.toLowerCase().startsWith(val) && cmd.length > val.length) {
                    bestMatch = cmd;
                    break;
                }
            }

            if (bestMatch) {
                // Show the full predicted command (typed part + suggestion)
                predictionEl.textContent = bestMatch;
            } else {
                predictionEl.textContent = '';
            }
        }

        // ==================== DISPLAY FUNCTIONS ====================
        function showHelp() {
            display(`<span class="section-title">‚ïê‚ïê‚ïê COMMANDS ‚ïê‚ïê‚ïê</span>

<span class="highlight">GENERAL</span>
  help              Show this help
  stats             Your farm stats
  clear             Clear logs
  save              Save game

<span class="highlight">SHOP</span>
  shop              View shop
  shop buy [item]   Purchase item
  shop sell [item] [qty]  Sell crops

<span class="highlight">FARM</span>
  farm              View farm
  farm plant [seed] [plot]
  farm water [plot]
  farm fertilize [plot]
  farm harvest [plot]

<span class="highlight">INVENTORY</span>
  inventory / inv   View items

<span class="dim">Plots: A1-A3, B1-B3, C1-C3</span>
<span class="dim">Example: farm plant carrot A1</span>`);
        }

        function showShop() {
            let html = `<span class="section-title">‚ïê‚ïê‚ïê üè™ SHOP ‚ïê‚ïê‚ïê</span>

<span class="pink">"Welcome to the farm shop!"</span>

<span class="highlight">SEEDS</span>
`;
            for (const [name, item] of Object.entries(state.shopItems)) {
                if (name.includes('seeds')) {
                    html += `  ${name.padEnd(15)} <span class="highlight">${String(item.price).padStart(3)}</span>¬¢  <span class="dim">${item.desc}</span>\n`;
                }
            }
            html += `\n<span class="highlight">TOOLS</span>\n`;
            for (const [name, item] of Object.entries(state.shopItems)) {
                if (!name.includes('seeds')) {
                    html += `  ${name.padEnd(15)} <span class="highlight">${String(item.price).padStart(3)}</span>¬¢  <span class="dim">${item.desc}</span>\n`;
                }
            }
            html += `\n<span class="dim">Your coins:</span> <span class="highlight">${state.coins}</span>`;
            display(html);
        }

        function showFarm() {
            let html = `<span class="section-title">‚ïê‚ïê‚ïê üåæ FARM ‚ïê‚ïê‚ïê</span>\n\n`;

            for (let row = 0; row < 3; row++) {
                const rowLetter = ['A', 'B', 'C'][row];
                let rowDisplay = '  ';
                for (let col = 0; col < 3; col++) {
                    const idx = row * 3 + col;
                    const plot = state.farm[idx];
                    const plotName = `${rowLetter}${col + 1}`;

                    let cell = '[üü´   ]';
                    if (plot) {
                        const elapsed = (Date.now() - plot.plantedAt) / 1000;
                        const progress = Math.min(elapsed / plot.growTime, 1);
                        const crop = state.crops[plot.type];

                        if (progress >= 1) {
                            cell = `[${crop.emoji}<span class="green">RDY</span>]`;
                        } else {
                            const stageIdx = Math.floor(progress * 2);
                            const remaining = Math.ceil(plot.growTime - elapsed);
                            cell = `[${crop.stages[stageIdx]}${String(remaining).padStart(3)}]`;
                        }
                    }
                    rowDisplay += `${plotName}${cell} `;
                }
                html += rowDisplay + '\n';
            }

            html += `\n<span class="dim">üü´=Empty üå±=Growing RDY=Ready to harvest</span>`;
            display(html);
        }

        function showInventory() {
            let html = `<span class="section-title">‚ïê‚ïê‚ïê üéí INVENTORY ‚ïê‚ïê‚ïê</span>\n\n`;
            const items = Object.entries(state.inventory).filter(([k, v]) => v > 0);

            if (items.length === 0) {
                html += `<span class="dim">Empty. Buy seeds from shop!</span>`;
            } else {
                for (const [name, count] of items) {
                    html += `  ${name.padEnd(18)} x${count}\n`;
                }
            }
            display(html);
        }

        function showStats() {
            display(`<span class="section-title">‚ïê‚ïê‚ïê üìä FARM STATS ‚ïê‚ïê‚ïê</span>

  Coins:       <span class="highlight">${state.coins}</span>¬¢
  Day:         <span class="highlight">${state.day}</span>
  Season:      <span class="highlight">${state.season}</span>

  Plots Used:  ${state.farm.filter(p => p !== null).length}/9

<span class="dim">Keep farming to earn more coins!</span>`);
        }

        // ==================== COMMANDS ====================
        function handleCommand(input) {
            const raw = input.trim();
            const parts = raw.toLowerCase().split(/\s+/);
            const cmd = parts[0];

            // Validate command
            const validRoots = ['help', '?', 'shop', 'farm', 'inventory', 'inv', 'i', 'stats', 'clear', 'save'];
            const isValid = validRoots.includes(cmd);

            logCommand(raw, isValid);

            if (!isValid) {
                action(`‚ùì Unknown: "${cmd}"`, 'error');
                return;
            }

            switch (cmd) {
                case 'help':
                case '?':
                    showHelp();
                    break;
                case 'shop':
                    handleShopCommand(parts);
                    break;
                case 'farm':
                    handleFarmCommand(parts);
                    break;
                case 'inventory':
                case 'inv':
                case 'i':
                    showInventory();
                    break;
                case 'stats':
                    showStats();
                    break;
                case 'clear':
                    document.getElementById('actions-log').innerHTML = '';
                    document.getElementById('command-log').innerHTML = '';
                    action('üßπ Cleared', 'system');
                    break;
                case 'save':
                    save();
                    action('üíæ Saved!', 'success');
                    break;
            }
        }

        function handleShopCommand(parts) {
            if (parts.length === 1) {
                showShop();
                return;
            }

            const shopAction = parts[1];

            if (shopAction === 'buy') {
                const itemName = parts.slice(2).join(' ');
                const item = state.shopItems[itemName];

                if (!item) {
                    action(`‚ùå Unknown item: "${itemName}"`, 'error');
                    return;
                }

                if (state.coins < item.price) {
                    action(`‚ùå Need ${item.price}¬¢, have ${state.coins}¬¢`, 'error');
                    return;
                }

                state.coins -= item.price;
                state.inventory[itemName] = (state.inventory[itemName] || 0) + 1;
                action(`‚úÖ Bought ${itemName} for ${item.price}¬¢`, 'success');
                updateStats();
                save();
                showShop();
            }
            else if (shopAction === 'sell') {
                const qty = parseInt(parts[parts.length - 1]) || 1;
                const hasQty = !isNaN(parseInt(parts[parts.length - 1]));
                const itemName = parts.slice(2, hasQty ? -1 : undefined).join(' ');

                if (!state.inventory[itemName] || state.inventory[itemName] < qty) {
                    action(`‚ùå Don't have ${qty}x ${itemName}`, 'error');
                    return;
                }

                const prices = { 'carrot': 25, 'tomato': 50, 'corn': 80, 'pumpkin': 120, 'golden': 400 };
                let sellPrice = 0;
                for (const [name, price] of Object.entries(prices)) {
                    if (itemName.includes(name)) { sellPrice = price; break; }
                }

                if (!sellPrice) {
                    action(`‚ùå Can't sell "${itemName}"`, 'error');
                    return;
                }

                state.inventory[itemName] -= qty;
                if (state.inventory[itemName] <= 0) delete state.inventory[itemName];
                const total = sellPrice * qty;
                addCoins(total);
                action(`üí∞ Sold ${qty}x ${itemName} for ${total}¬¢`, 'success');
                showInventory();
            }
            else {
                action(`‚ùå Unknown shop command: "${shopAction}"`, 'error');
            }
        }

        function handleFarmCommand(parts) {
            if (parts.length === 1) {
                showFarm();
                return;
            }

            const farmAction = parts[1];

            if (farmAction === 'plant') {
                const plotName = parts[parts.length - 1].toUpperCase();
                const seedName = parts.slice(2, -1).join(' ');
                const plotIdx = getPlotIndex(plotName);

                if (plotIdx === -1) {
                    action(`‚ùå Invalid plot: "${plotName}"`, 'error');
                    return;
                }

                if (state.farm[plotIdx]) {
                    action(`‚ùå Plot ${plotName} is occupied!`, 'error');
                    return;
                }

                const fullSeedName = seedName.includes('seeds') ? seedName : seedName + ' seeds';

                if (!state.inventory[fullSeedName] || state.inventory[fullSeedName] < 1) {
                    action(`‚ùå No ${fullSeedName} in inventory`, 'error');
                    return;
                }

                if (!state.crops[fullSeedName]) {
                    action(`‚ùå Unknown seed: "${fullSeedName}"`, 'error');
                    return;
                }

                state.inventory[fullSeedName]--;
                if (state.inventory[fullSeedName] <= 0) delete state.inventory[fullSeedName];

                state.farm[plotIdx] = {
                    type: fullSeedName,
                    plantedAt: Date.now(),
                    growTime: state.crops[fullSeedName].growTime,
                    watered: false
                };
                action(`üå± Planted ${seedName} in ${plotName}`, 'success');
                save();
                showFarm();
            }
            else if (farmAction === 'water') {
                const plotName = parts[2]?.toUpperCase();
                const plotIdx = getPlotIndex(plotName);

                if (plotIdx === -1) {
                    action(`‚ùå Invalid plot: "${plotName}"`, 'error');
                    return;
                }

                if (!state.farm[plotIdx]) {
                    action(`‚ùå Nothing in ${plotName}`, 'error');
                    return;
                }

                if (!state.farm[plotIdx].watered) {
                    state.farm[plotIdx].watered = true;
                    state.farm[plotIdx].growTime *= 0.8;
                    action(`üíß Watered ${plotName}! +20% growth`, 'success');
                    save();
                } else {
                    action(`üíß ${plotName} already watered`, 'warning');
                }
                showFarm();
            }
            else if (farmAction === 'fertilize') {
                const plotName = parts[2]?.toUpperCase();
                const plotIdx = getPlotIndex(plotName);

                if (plotIdx === -1) {
                    action(`‚ùå Invalid plot: "${plotName}"`, 'error');
                    return;
                }

                if (!state.farm[plotIdx]) {
                    action(`‚ùå Nothing in ${plotName}`, 'error');
                    return;
                }

                if (!state.inventory['fertilizer'] || state.inventory['fertilizer'] < 1) {
                    action(`‚ùå No fertilizer!`, 'error');
                    return;
                }

                state.inventory['fertilizer']--;
                if (state.inventory['fertilizer'] <= 0) delete state.inventory['fertilizer'];

                const elapsed = (Date.now() - state.farm[plotIdx].plantedAt) / 1000;
                const remaining = state.farm[plotIdx].growTime - elapsed;
                state.farm[plotIdx].growTime -= remaining / 2;
                action(`üß™ Fertilized ${plotName}! Time halved`, 'success');
                save();
                showFarm();
            }
            else if (farmAction === 'harvest') {
                const plotName = parts[2]?.toUpperCase();
                const plotIdx = getPlotIndex(plotName);

                if (plotIdx === -1) {
                    action(`‚ùå Invalid plot: "${plotName}"`, 'error');
                    return;
                }

                if (!state.farm[plotIdx]) {
                    action(`‚ùå Nothing in ${plotName}`, 'error');
                    return;
                }

                const plot = state.farm[plotIdx];
                const elapsed = (Date.now() - plot.plantedAt) / 1000;

                if (elapsed < plot.growTime) {
                    const remaining = Math.ceil(plot.growTime - elapsed);
                    action(`‚ùå Not ready! ${remaining}s left`, 'error');
                    return;
                }

                const crop = state.crops[plot.type];
                const cropName = plot.type.replace(' seeds', '');
                state.inventory[cropName] = (state.inventory[cropName] || 0) + 1;
                state.farm[plotIdx] = null;
                action(`üåæ Harvested ${crop.emoji} ${cropName}!`, 'success');
                action(`üí° Sell with: shop sell ${cropName} 1`, 'system');
                save();
                showFarm();
            }
            else {
                action(`‚ùå Unknown farm command: "${farmAction}"`, 'error');
            }
        }

        // ==================== INIT ====================
        function init() {
            load();
            updateStats();

            const inputEl = document.getElementById('input');

            // Update prediction on every keystroke
            inputEl.addEventListener('input', (e) => {
                updatePrediction(e.target.value);
            });

            inputEl.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && e.target.value.trim()) {
                    handleCommand(e.target.value);
                    e.target.value = '';
                    updatePrediction('');
                }
            });

            // Auto-refresh farm view every second
            setInterval(() => {
                const disp = document.getElementById('display');
                if (disp.innerHTML.includes('FARM') && !disp.innerHTML.includes('STATS')) {
                    showFarm();
                }
            }, 1000);

            action('üå± Welcome to TypeFarm!', 'success');
            action("Type 'help' to get started", 'system');
            showHelp();
        }

        init();
    </script>
</body>
</html>
